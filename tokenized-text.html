<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text Tokenizer Visualizer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica', 'Arial', sans-serif;
            background: #ffffff;
            margin: 0;
            padding: 0;
            color: #333;
        }

        .container {
            width: 100%;
            margin: 0;
            background: #ffffff;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 2em;
            color: #333;
            font-family: 'Helvetica', 'Arial', sans-serif;
        }

        .description {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 16px;
            line-height: 1.5;
        }

        .tokenizer-info {
            background: #f0f8ff;
            border: 1px solid #d1ecf1;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
        }

        .tokenizer-info a {
            color: #007bff;
            text-decoration: none;
        }

        .tokenizer-info a:hover {
            text-decoration: underline;
        }

        .input-section {
            margin-bottom: 30px;
        }

        .input-label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #333;
        }

        .text-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            font-family: 'Helvetica', 'Arial', sans-serif;
            resize: vertical;
            min-height: 80px;
        }

        .text-input:focus {
            outline: none;
            border-color: #333;
        }

        .visualization-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            font-size: 18px;
        }

        .tokenized-text {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            min-height: 100px;
            line-height: 2;
            font-size: 16px;
        }

        .token {
            display: inline-block;
            padding: 4px 8px;
            margin: 2px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            white-space: pre;
            border: 1px solid rgba(0,0,0,0.1);
        }

        .token:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            z-index: 10;
        }

        .token-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
            margin-bottom: 5px;
            z-index: 20;
        }

        .token:hover .token-tooltip {
            opacity: 1;
        }

        .token-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            border: 4px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.9);
            transform: translateX(-50%);
        }

        .stats-section {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #333;
            display: block;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        .token-list {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            max-height: 200px;
            overflow-y: auto;
        }

        .token-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
            font-family: monospace;
        }

        .token-item:last-child {
            border-bottom: none;
        }

        .token-text {
            flex: 1;
            padding-right: 10px;
        }

        .token-id {
            font-weight: bold;
            color: #666;
            min-width: 80px;
            text-align: right;
        }

        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 20px;
        }

        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 1.8em;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>How AI Reads Text</h1>
        
        <div class="description">
            Large Language Models (LLMs) don't read text the way humans do. They break text into small pieces called "tokens" and convert each piece into numbers. This uses the actual GPT tokenizer to show you real tokenization.
        </div>

        <div class="tokenizer-info">
            <strong>Using:</strong> GPT-3/GPT-4 Tokenizer (cl100k_base encoding) • 
            <strong>Library:</strong> <a href="https://github.com/niieani/gpt-tokenizer" target="_blank">gpt-tokenizer</a> • 
            <strong>Based on:</strong> <a href="https://github.com/openai/tiktoken" target="_blank">OpenAI's tiktoken</a>
        </div>

        <div class="input-section">
            <label class="input-label" for="textInput">Enter your text:</label>
            <textarea 
                id="textInput" 
                class="text-input" 
                placeholder="Type something here... Try: 'The cat sat on the mat'"
            >The cat sat on the mat</textarea>
        </div>

        <div class="visualization-section">
            <div class="section-title">Tokenized Text (hover to see token IDs):</div>
            <div id="tokenizedOutput" class="tokenized-text">
                <div class="loading">Loading tokenizer...</div>
            </div>
        </div>

        <div class="stats-section">
            <div class="stats-grid">
                <div class="stat-item">
                    <span id="characterCount" class="stat-number">0</span>
                    <span class="stat-label">Characters</span>
                </div>
                <div class="stat-item">
                    <span id="tokenCount" class="stat-number">0</span>
                    <span class="stat-label">Tokens</span>
                </div>
                <div class="stat-item">
                    <span id="compressionRatio" class="stat-number">0</span>
                    <span class="stat-label">Chars per Token</span>
                </div>
            </div>
        </div>

        <div class="visualization-section">
            <div class="section-title">Token → Number Mapping:</div>
            <div id="tokenList" class="token-list">
                <div class="loading">Enter text above to see token mappings...</div>
            </div>
        </div>
    </div>

    <!-- Load the GPT tokenizer library from CDN -->
    <script type="module">
        import { encode, decode } from 'https://cdn.skypack.dev/gpt-tokenizer';
        
        let isLoading = false;

        function getTokenColor(tokenId) {
            // Generate consistent colors based on token ID
            const colors = [
                '#FFE5E5', '#E5F3FF', '#E5FFE5', '#FFF3E5', '#F3E5FF',
                '#FFE5F3', '#E5FFFF', '#F5FFE5', '#FFE5CC', '#E5E5FF',
                '#CCFFE5', '#FFCCF3', '#CCF3FF', '#F3FFCC', '#FFCCCC',
                '#E5CCFF', '#CCFFE5', '#FFCC99', '#99CCFF', '#FF99CC'
            ];
            return colors[Math.abs(tokenId) % colors.length];
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function updateVisualization() {
            const inputText = document.getElementById('textInput').value;
            
            try {
                // Tokenize the text using gpt-tokenizer
                const tokens = encode(inputText);
                const tokenStrings = tokens.map(tokenId => decode([tokenId]));
                
                // Update tokenized output
                const outputDiv = document.getElementById('tokenizedOutput');
                outputDiv.innerHTML = '';
                
                if (tokens.length === 0) {
                    outputDiv.innerHTML = '<span style="color: #999; font-style: italic;">Enter some text above to see tokenization...</span>';
                } else {
                    tokens.forEach((tokenId, index) => {
                        const tokenString = tokenStrings[index];
                        const tokenElement = document.createElement('span');
                        tokenElement.className = 'token';
                        tokenElement.style.backgroundColor = getTokenColor(tokenId);
                        
                        // Display the token text, handling special characters
                        const displayText = tokenString.replace(/\n/g, '↵').replace(/\t/g, '→');
                        tokenElement.innerHTML = escapeHtml(displayText);
                        
                        const tooltip = document.createElement('div');
                        tooltip.className = 'token-tooltip';
                        tooltip.textContent = `Token ID: ${tokenId}`;
                        tokenElement.appendChild(tooltip);
                        
                        outputDiv.appendChild(tokenElement);
                    });
                }
                
                // Update stats
                document.getElementById('characterCount').textContent = inputText.length;
                document.getElementById('tokenCount').textContent = tokens.length;
                document.getElementById('compressionRatio').textContent = 
                    tokens.length > 0 ? (inputText.length / tokens.length).toFixed(1) : '0';
                
                // Update token list
                const tokenListDiv = document.getElementById('tokenList');
                tokenListDiv.innerHTML = '';
                
                if (tokens.length === 0) {
                    tokenListDiv.innerHTML = '<div style="color: #999; font-style: italic; text-align: center;">No tokens to display</div>';
                } else {
                    tokens.forEach((tokenId, index) => {
                        const tokenString = tokenStrings[index];
                        const itemDiv = document.createElement('div');
                        itemDiv.className = 'token-item';
                        
                        const textSpan = document.createElement('span');
                        textSpan.className = 'token-text';
                        // Show special characters clearly
                        const displayText = tokenString
                            .replace(/\n/g, '\\n')
                            .replace(/\t/g, '\\t')
                            .replace(/ /g, '·'); // Show spaces as middle dots
                        textSpan.textContent = `"${displayText}"`;
                        
                        const idSpan = document.createElement('span');
                        idSpan.className = 'token-id';
                        idSpan.textContent = tokenId;
                        
                        itemDiv.appendChild(textSpan);
                        itemDiv.appendChild(idSpan);
                        tokenListDiv.appendChild(itemDiv);
                    });
                }
                
            } catch (error) {
                console.error('Tokenization error:', error);
                document.getElementById('tokenizedOutput').innerHTML = 
                    '<div class="error">Error processing text: ' + error.message + '</div>';
            }
        }

        // Event listeners
        document.getElementById('textInput').addEventListener('input', updateVisualization);
        document.getElementById('textInput').addEventListener('paste', () => {
            setTimeout(updateVisualization, 10);
        });

        // Initialize visualization
        document.getElementById('tokenizedOutput').innerHTML = '<div class="loading">Tokenizer ready!</div>';
        updateVisualization();
    </script>
</body>
</html>
